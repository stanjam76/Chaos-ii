<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chaos II — Ninja Porcupine</title>
  <style>
    html,body { margin:0; height:100%; background:#050915; overflow:hidden; }
    #ui { position:fixed; inset:auto 12px 12px auto; color:#8df; font:12px/1.2 system-ui; opacity:.75 }
    a { color:#9ff; text-decoration:none; border-bottom:1px dashed #46c }
    a:hover { opacity:1 }
  </style>
</head>
<body>
  <div id="ui">Tap/Click to make the porcupine dash →</div>

  <!-- Three.js from CDN -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <!-- Text helper (optional). If it fails to load, page still works. -->
  <script src="https://unpkg.com/three@0.160.0/examples/jsm/loaders/FontLoader.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/examples/jsm/geometries/TextGeometry.min.js"></script>

  <script>
  // ----- Scene basics -----
  const scene   = new THREE.Scene();
  const camera  = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
  const renderer= new THREE.WebGLRenderer({ antialias:true, alpha:false });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
  document.body.appendChild(renderer.domElement);

  camera.position.set(0, 0.6, 7);

  // Lighting
  scene.add(new THREE.AmbientLight(0x8cc7ff, 0.6));
  const key = new THREE.PointLight(0x77aaff, 1.2, 0, 2);
  key.position.set(3, 3, 5);
  scene.add(key);

  // ----- Star field -----
  (function makeStars(count=1200){
    const geo = new THREE.BufferGeometry();
    const pos = new Float32Array(count*3);
    for (let i=0;i<count;i++){
      const r = 60*Math.cbrt(Math.random());
      const t = Math.random()*Math.PI*2;
      const p = (Math.random()-0.5)*Math.PI;
      pos[i*3+0] = r*Math.cos(t)*Math.cos(p);
      pos[i*3+1] = r*Math.sin(p);
      pos[i*3+2] = r*Math.sin(t)*Math.cos(p);
    }
    geo.setAttribute('position', new THREE.BufferAttribute(pos,3));
    const mat = new THREE.PointsMaterial({ color:0x77aaff, size:0.05 });
    scene.add(new THREE.Points(geo, mat));
  })();

  // ----- Porcupine billboard (uses your porcupine.jpg in repo root) -----
  const loader = new THREE.TextureLoader();
  loader.load('porcupine.jpg', tex => {
    tex.colorSpace = THREE.SRGBColorSpace;
    const geo = new THREE.PlaneGeometry(3.2, 2.2);
    const mat = new THREE.MeshStandardMaterial({
      map: tex, transparent: false, roughness: 0.8, metalness: 0.0
    });
    const card = new THREE.Mesh(geo, mat);
    card.position.set(0, 0.25, 0);
    scene.add(card);

    // Ninja idle motion
    let t = 0, dashCooldown = 0;
    function idle(dt){
      t += dt;
      card.rotation.y = Math.sin(t*0.9)*0.25;
      card.rotation.x = Math.sin(t*0.5)*0.07;
      card.position.y = 0.25 + Math.sin(t*1.7)*0.08;
    }

    function dash(){
      if (dashCooldown>0) return;
      dashCooldown = 1.6;
      // Animate forward then snap back
      const startZ = card.position.z;
      const startS = card.scale.clone();
      let dT = 0;
      const doDash = (dt)=>{
        dT += dt;
        const u = Math.min(dT/0.6, 1);
        // ease out
        const e = 1 - Math.pow(1-u, 3);
        card.position.z = THREE.MathUtils.lerp(startZ, -1.2, e);
        card.scale.setScalar(THREE.MathUtils.lerp(startS.x, 1.35, e));
        if (u<1) return;
        // fly back
        const back = (dt2)=>{
          dT += dt2;
          const u2 = Math.min((dT-0.6)/1.0, 1);
          const e2 = Math.pow(1-u2, 2);
          card.position.z = THREE.MathUtils.lerp(-1.2, startZ, 1-e2);
          card.scale.setScalar(THREE.MathUtils.lerp(1.35, startS.x, 1-e2));
          if (u2>=1) {
            dashCooldown = 0;
            ticker.splice(ticker.indexOf(back),1);
          }
        };
        ticker.push(back);
        ticker.splice(ticker.indexOf(doDash),1);
      };
      ticker.push(doDash);
    }

    // Click / tap to dash
    addEventListener('pointerdown', dash);

    // register idle updater
    const update = (dt)=> idle(dt);
    ticker.push(update);
  }, undefined, err => {
    console.warn('Could not load porcupine.jpg. Put the file in repo root.');
  });

  // ----- (Optional) Glowing text -----
  try {
    new THREE.FontLoader().load(
      'https://unpkg.com/three@0.160.0/examples/fonts/helvetiker_regular.typeface.json',
      font => {
        const geo = new THREE.TextGeometry('CHAOS IS COMING', {
          font, size: 0.45, height: 0.08, curveSegments: 6,
        });
        geo.center();
        const mat = new THREE.MeshStandardMaterial({ color:0x66ccff, emissive:0x0a2a66, emissiveIntensity: 1.2 });
        const mesh = new THREE.Mesh(geo, mat);
        mesh.position.set(0, -1.1, 0);
        scene.add(mesh);
        ticker.push(dt => mesh.rotation.y += dt*0.25);
      }
    );
  } catch(e){ /* optional */ }

  // ----- Ticker / render loop -----
  const ticker = [];
  let last = performance.now();
  function frame(now){
    const dt = Math.min((now-last)/1000, 0.033);
    last = now;
    for (const fn of ticker) fn(dt);
    renderer.render(scene, camera);
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);

  // Resize
  addEventListener('resize', ()=> {
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });
  </script>
</body>
</html>
